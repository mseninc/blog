---
title: ログオン時にコマンドでWi-Fiに接続する方法
date: 
author: norikazum
tags: [Windows,バッチ]
description: 
---

こんにちは。

先日、お客様の端末で **有線と無線の両方で接続している端末** で、ログオン後に **無線接続が切断されてしまう現象** が発生しました。

接続はこのようなイメージです。
![](images/2022-05-23_16h17_07.jpg)

## 環境
- Windows 10 ( 2022年1月の確認時点で最新 )

## 現象
ログオン直後にネットワーク接続を見ていると、しばらくすると切断されていることがわかりました。
![](images/PXL_20220107_065839911.MP_R.jpg)
↓
![](images/PXL_20220107_065842538.MP_R.jpg)

切断された後に手動で接続すると問題なく接続できる状況でした。

## 切り分け
1. デバイスマネージャーの詳細設定から 802.11n/ac/ax ワイヤレスモードを無効にするなど変更しても改善しませんでした。
![](images/2022-01-10_18h23_45.jpg)

2.  端末の交換、無線ルーター（図中ルーターA）も交換しましたが改善しませんでした。

3. 端末が接続されている有線ポートをルーターB側で変更しても改善しませんでした。

レジストリー変更やローカルポリシーを変更すると改善する可能性があると[kenzauros](https://github.com/kenzauros) からアドバイスをもらい確認しましたが、こちらも改善しませんでした。

詳細は以下のとおりです。

4. レジストリー変更
- レジストリーエディター (regedit) を開き、`HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WcmSvc\Local` を開く
- `DWORD 値 (32 bit)` を追加し、名前を `fMinimizeConnections` に変更して再起動 ※値は 0 のままで OK
![](images/148870967-46672096-9113-43e0-aaa2-957fd8bef9cc.png)

5. ローカルポリシーで以下の4つを無効にする
![](images/148879441-e73869c5-6f86-4212-b6d6-d6df407842fd.png)

## 対処
残念ながら今回のケースは根本原因を見つけることができませんでした。
対処療法となりますが、以下の方法で接続を維持できました。

1. 対象のSSIDの自動接続をオフにします。
![](images/PXL_20220107_071143362_R.jpg)

1. 任意の場所に以下のバッチを作成します。今回は例として `D:\wifi_connect.bat` とします。
```bat
netsh wlan connect name="TP-LINK_7***"
```

1. 以下のようなタスクを作成します。
![](images/PXL_20220107_071339939.MP_R.jpg)
![](images/2022-01-10_21h59_42.jpg)
![](images/PXL_20220107_071351207_R.jpg)
![](images/PXL_20220107_071358418_R.jpg)

1. タスクのプロパティーを変更します。
![](images/PXL_20220107_071413918.MP_R.jpg)

この方法でログオン後に手動でWi-Fiを接続する手間な運用をさけることができました。
※ 対処のSSIDの接続情報が保存されていることが前提になります。

## 参考
[WindowsのWi-Fi操作をコマンドプロンプトから行う - Qiita](https://qiita.com/mindwood/items/22e0895473578c4e0c7e)

同じ現象に悩まされている方がおられましたら一度お試しください。
それでは次回の記事でお会いしましょう。
