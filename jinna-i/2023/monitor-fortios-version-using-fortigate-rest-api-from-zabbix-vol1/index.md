---
title: "Zabbix ã‹ã‚‰ FortiGate REST API ã‚’ä½¿ã£ã¦ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç›£è¦–ã™ã‚‹ï¼ˆAPI ç·¨ï¼‰"
date: 
author: jinna-i
tags: [FortiGate, Zabbix]
description: "æ˜¨ä»Šã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£äº‹æƒ…ã‹ã‚‰ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’æŠŠæ¡ã—ã¦ãŠãã“ã¨ã¯å¤§åˆ‡ã§ã™ã€‚ä»Šå›ã¯ FortiGate REST API ã‚’ä½¿ã£ã¦ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚"
---

ã“ã‚“ã«ã¡ã¯ã€ã˜ã‚“ãªã„ã§ã™ã€‚

æ˜¨ä»Šã®ã‚³ãƒ­ãƒŠç¦ã«ã‚ˆã‚‹ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ã®å¢—åŠ ã«ä¼´ã„ã€VPN ã‚’ä½¿ç”¨ã—ã¦ç¤¾å†…ã®ç’°å¢ƒã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚å¢—åŠ ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ãã‚Œã«ä¼´ã£ã¦ **VPN è£…ç½®ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ãŸæ”»æ’ƒã‚‚å¢—åŠ **ã—ã¦ã„ã¾ã™ã€‚

[JPCERT ã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼](https://www.jpcert.or.jp/) ã® Weekly Report ã§ã‚‚ FortiOS ã®è„†å¼±æ€§ã«é–¢ã™ã‚‹æƒ…å ±ãŒå¢—ãˆã¦ã„ã¾ã™ã€‚

è„†å¼±æ€§ãŒå…¬è¡¨ã•ã‚ŒãŸå ´åˆã€ã„ã¡æ—©ããƒ‘ãƒƒãƒã‚’é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚FortiGate ãªã©ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£…ç½®ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¨ã‚¤ãƒ³ãƒˆãƒ©ãƒãƒƒãƒˆãƒãƒƒãƒˆã®å¢ƒç•Œã§ã‚ã‚‹ã“ã¨ãŒå¤šãã€ã‚ˆã‚Šæ—©æ€¥ãªå¯¾å¿œãŒæœ›ã¾ã‚Œã¾ã™ã€‚

è„†å¼±æ€§ãŒå…¬è¡¨ã•ã‚ŒãŸå ´åˆã«å¿…è¦ãªæƒ…å ±ã¨ã—ã¦ **ã€Œã©ã® FortiGate ãŒã©ã® FortiOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ç¨¼åƒã—ã¦ã„ã‚‹ã®ã‹ã€** ã‚’æŠŠæ¡ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

è‡ªç¤¾ã® FortiGate ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã ã‘ãªã‚‰ã¾ã ã—ã‚‚ã€ãŠå®¢æ§˜ã®ç’°å¢ƒã® FortiGate ã‚’è¤‡æ•°ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã€å¤§å¤‰ã«ãªã£ã¦ãã¾ã™ã€‚

ãã®ã‚ˆã†ãªå•é¡Œã‚’è§£æ¶ˆã™ã¹ãã€æœ¬è¨˜äº‹ã§ã¯ **Zabbix ã‹ã‚‰ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç›£è¦–ã™ã‚‹æ–¹æ³•**ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

Zabbix Proxy ãªã©ã®æ•´å‚™ã¯å¿…è¦ã§ã™ãŒå„ã‚µã‚¤ãƒˆã§ã® FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ Zabbix ã§ä¸€å…ƒç®¡ç†ã§ãã‚‹ã¨ä¾¿åˆ©ã§ã™ã­ã€‚

ã¾ãšã¯å‰ç·¨ã¨ã—ã¦ **FortiGate REST API ã‚’ä½¿ã£ã¦ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹æ–¹æ³•**ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

â€» å¾Œç·¨ã§ã¯ã“ã® API ã‚’ä½¿ã£ã¦ Zabbix ã‹ã‚‰ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç›£è¦–ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹äºˆå®šã§ã™ã€‚

## æƒ³å®šç’°å¢ƒ

- ãƒ¢ãƒ‡ãƒ«: FortiGate 60F
- FortiOS: FortiOS v6.4.12

## ç®¡ç†è€…ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®æœ‰åŠ¹åŒ–

ã¾ãšã€REST API ã‚’ä½¿ã†æº–å‚™ã¨ã—ã¦ç®¡ç†è€…ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

REST API ã‚’å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹è¨­å®šã® [ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹] ã§ `HTTPS` ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

![HTTPS ç®¡ç†ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®æœ‰åŠ¹åŒ–](images/001.png)

## REST API ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

æ¬¡ã«ã€REST API ã‚’å®Ÿè¡Œã™ã‚‹ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

[ã‚·ã‚¹ãƒ†ãƒ ] > [ç®¡ç†è€…] > [æ–°è¦ä½œæˆ] ã‹ã‚‰ `REST API ç®¡ç†è€…` ã‚’é¸æŠã—ã¾ã™ã€‚

![REST API ç®¡ç†è€…ã®ä½œæˆ1](images/002.png)

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ç®¡ç†è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€ä¿¡é ¼ã•ã‚Œã‚‹ãƒ›ã‚¹ãƒˆã‚’è¨­å®šã—ä½œæˆã—ã¾ã™ã€‚

![REST API ç®¡ç†è€…ã®ä½œæˆ2](images/003.png)

ç®¡ç†è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—ã«å¿…è¦ãªæœ€å°ã®æ¨©é™ã‚’ã‚‚ã£ãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

ç§ãŒè©¦ã—ãŸç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã§å¯èƒ½ã§ã—ãŸã€‚

[ã‚·ã‚¹ãƒ†ãƒ ] > [ã‚«ã‚¹ã‚¿ãƒ ] > [è¨­å®š] ã‚’ `èª­ã¿å–ã‚Š` ã§ä½œæˆã€‚

![API ã®æ¨©é™è¨­å®š](images/004.png)

ä½œæˆã™ã‚‹ã¨ API ã‚­ãƒ¼ãŒç™ºè¡Œã•ã‚Œã¾ã™ã®ã§æ§ãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚

![API ã‚­ãƒ¼ã®å–å¾—](images/005.png)


## API ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹

ã§ã¯å®Ÿéš›ã« API ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚å‰é …ã§è¨­å®šã—ãŸä¿¡é ¼ã•ã‚Œã‚‹ãƒ›ã‚¹ãƒˆã‹ã‚‰ã—ã‹å®Ÿè¡Œã§ããªã„ã®ã§æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’èµ·å‹•ã—ã¦ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚

`curl -k -X GET https://<FortiGate FQDN>/api/v2/monitor/system/status/?access_token=<API ã‚­ãƒ¼>`

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ğŸ‘‡ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```cmd{15}
C:\Users\jinna-i>curl -k -X GET https://<FortiGate FQDN>/api/v2/monitor/system/status/?access_token=<API ã‚­ãƒ¼>
{
  "http_method":"GET",
  "results":{
    "model_name":"FortiGate",
    "model_number":"60F",
    "model":"FGT60F",
    "hostname":"<ãƒ›ã‚¹ãƒˆå>"
  },
  "vdom":"root",
  "path":"system",
  "name":"status",
  "status":"success",
  "serial":"<ã‚·ãƒªã‚¢ãƒ«ç•ªå·>",
  "version":"v6.4.12",
  "build":2060
}
```

ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå–å¾—ã§ãã¦ã„ã¾ã™ã€‚

REST API ã¯ FortiGate CLI ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªé–¢ä¿‚ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

REST API URL | å¯¾å¿œã‚³ãƒãƒ³ãƒ‰ | ä½¿ã„æ–¹
-- | -- | --
/api/v2/cmdb | config xx yy | /cmdb/xx/yy
/api/v2/monitor | get xx yy | /monitor/xx/yy

[FortiGateã®REST APIã‚’åˆ©ç”¨ã—ã¦ã¿ãŸ - Qiita](https://qiita.com/kkmiura/items/80d8f8d1f3db0d07ec32)

FortiGate CLI ã§ `get system status` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå–å¾—ã§ãã‚‹ã®ã§ä»Šå›ã¯ãã® API ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

ä»¥ä¸Šã§ FortiGate REST API ã‚’ä½¿ã£ã¦ FortiOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå–å¾—ã§ãã¾ã—ãŸã€‚

æ¬¡å›ã¯ã“ã® REST API ã‚’ä½¿ã£ã¦ Zabbix ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç›£è¦–ã—ã¦ã¿ã¾ã™ã€‚

ãã‚Œã§ã¯ã¾ãŸã€‚


## å‚è€ƒ

- [REST API administrator | FortiGate / FortiOS 6.4.12](https://docs.fortinet.com/document/fortigate/6.4.12/administration-guide/399023/rest-api-administrator)


- [Using APIs | FortiGate / FortiOS 6.4.12](https://docs.fortinet.com/document/fortigate/6.4.12/administration-guide/940602)
