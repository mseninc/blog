---
title: "[React] useEffect ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§å†å®Ÿè¡Œã™ã‚‹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…ã™ã‚‹"
date: 
author: kenzauros
tags: [React]
description: 
---

ã“ã‚“ã«ã¡ã¯ã€ kenzauros ã§ã™ã€‚

*Reack hooks ã§éåŒæœŸã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ useEffect ã‚’ä½¿ç”¨*ã—ã¾ã™ã€‚

é€šå¸¸ã€ä½•ã‚‰ã‹ã® state ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€å¿…è¦ã§ã‚ã‚Œã° useEffect ãŒå†å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ãŸã ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ãŸã„**å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ç‰¹ã«è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»Šã®æ¡ä»¶ã§æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãªãŠã™ã®ã¯ã‚ˆãã‚ã‚‹å ´é¢ã ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã¯ **ã€ŒRefesh ãƒœã‚¿ãƒ³ã€ã‚’è¿½åŠ ã—ã¦ useEffect ã‚’å†å®Ÿè¡Œã•ã›ã‚‹** 1 ã¤ã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ğŸ”„ ğŸ‘ˆã“ã†ã„ã†ãƒœã‚¿ãƒ³ã§ã™ã­ã€‚

## æƒ³å®šã™ã‚‹ React ã‚¢ãƒ—ãƒª

ã¾ãšã€ä¸‹è¨˜ã®ã‚ˆã†ãªå˜ç´”ãª React ã‚¢ãƒ—ãƒªã‚’æƒ³å®šã—ã¾ã™ã€‚

![](images/app_before.gif "å…ƒã®App")

*ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã®å…¥åŠ›æ¬„ãŒã‚ã‚Šã€ãã®å€¤ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ API ã‹ã‚‰å–å¾—ã—ã€åå‰ã‚’è¡¨ç¤ºã™ã‚‹*ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚æ›´æ–°ãŒã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã¤ã‘ã¦å‹•çš„ã«ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

```js{numberLines:1}:title=å…ƒã®App
import { useState, useEffect } from 'react'

function App() {
  const [userId, setUserId] = useState(0)
  const [user, setUser] = useState()

  useEffect(() => {
    const data = {
        id: userId,
        name: `User${userId}_${new Date().getTime()}`,
    } // ğŸ‘ˆ æœ¬æ¥ã¯ API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã‚‹
    setUser(data)
  }, [userId])

  return (
      <div style={{margin: 16}}>
          <input value={userId} onChange={event => setUserId(event.target.value)} />
          <p>{user?.name || ""}</p>
      </div>
  )
}

export default App
```

ã“ã® useEffect ã®ç¬¬2å¼•æ•° (ä¾å­˜ãƒªã‚¹ãƒˆ) ã«ã¯ `userId` ã‚’æŒ‡å®šã—ã¦ã‚ã‚‹ãŸã‚ã€ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã§ *`userId` ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ useEffect ãŒå†å®Ÿè¡Œ*ã•ã‚Œã¾ã™ã€‚

é€†ã«è¨€ãˆã° **`userId` ãŒå¤‰æ›´ã•ã‚Œãªã„é™ã‚Šã€ useEffect ãŒå†å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“**ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å†èª­è¾¼ã—ãŸã„å ´åˆã¯ã€ä¸€åº¦é©å½“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã«å¤‰æ›´ã—ãŸã‚ã¨ã€å†åº¦å…ƒã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã«æˆ»ã™ã€ãªã‚“ã¦ç„¡é§„ãªæ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

## æ›´æ–° (Refresh) ãƒœã‚¿ãƒ³ã®å®Ÿè£…

ãã“ã§ã€ã“ã“ã« *ã€ŒRefresh ãƒœã‚¿ãƒ³ã€ã‚’è¿½åŠ ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã‚’å¤‰æ›´ã›ãšã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å†èª­è¾¼*ã‚’ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

ç™ºæƒ³ã¨ã—ã¦ã¯ã€Œ**state ãŒæ›´æ–°ã•ã‚Œãªã„ã¨å†å®Ÿè¡Œã•ã‚Œãªã„ã®ãªã‚‰ã€æ›´æ–°ã™ã‚‹ state ã‚’å¢—ã‚„ã—ã¡ã‚ƒãˆã°ã„ã„ã˜ã‚ƒã‚“**ã€ã§ã™ã€‚

```js{numberLines:1}{6,14,20}:title=Refreshãƒœã‚¿ãƒ³è¿½åŠ å¾Œã®App
import { useState, useEffect } from 'react'

function App() {
  const [userId, setUserId] = useState(0)
  const [user, setUser] = useState()
  const [refreshKey, setRefreshKey] = useState(0)

  useEffect(() => {
    const data = {
        id: userId,
        name: `User${userId}_${new Date().getTime()}`,
    } // ğŸ‘ˆ æœ¬æ¥ã¯ API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã‚‹
    setUser(data)
  }, [userId, refreshKey])

  return (
      <div style={{margin: 16}}>
          <input value={userId} onChange={event => setUserId(event.target.value)} />
          <p>{user?.name || ""}</p>
          <button type="button" onClick={() => setRefreshKey(old => old + 1)}>ğŸ”„</button>
      </div>
  )
}

export default App
```

ã¯ã„ã€ç°¡å˜ã§ã™ã­ã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªå‹•ãã«ãªã‚Šã¾ã™ã€‚

![](images/app_after.gif "Refreshãƒœã‚¿ãƒ³è¿½åŠ å¾Œã®App")

ã¾ã¨ã‚ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªå®Ÿè£…ã§ã™ã€‚

1. ã€ŒRefresh ãƒœã‚¿ãƒ³ã€ç”¨ã® state (`refreshKey`) ã‚’è¿½åŠ  (6 è¡Œç›®)
2. `refreshKey` ã‚’ useEffect ã®ä¾å­˜ãƒªã‚¹ãƒˆ (ç¬¬2å¼•æ•°) ã«è¿½åŠ  (14 è¡Œç›®)
3. ã€ŒRefresh ãƒœã‚¿ãƒ³ã€ã§ `refreshKey` ã‚’æ›´æ–° (18 è¡Œç›®)

ã“ã® state ã¯æ¯å›æ›´æ–°ã•ã‚Œã‚Œã°ãªã‚“ã§ã‚‚ã‚ˆãã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ãŒã€ã“ã®ä¾‹ã®ã‚ˆã†ã«æ•°å€¤ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦ã„ãã®ãŒä¸€ç•ªç°¡å˜ã§ã—ã‚‡ã†ã€‚

ã“ã‚Œã§ã¾ã•ã« "REACTive" ãªå‹•ããŒå®Ÿç¾ã§ãã¾ã—ãŸã€‚

ç°¡å˜ãªå†…å®¹ã§ã—ãŸãŒã€ã©ãªãŸã‹ã®ãŠå½¹ã«ç«‹ã¦ã‚Œã°å¹¸ã„ã§ã™ã€‚
