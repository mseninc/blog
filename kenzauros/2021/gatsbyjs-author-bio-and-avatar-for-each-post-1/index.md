---
title: Gatsby ã§è¨˜äº‹ã”ã¨ã®è‘—è€…æƒ…å ±ã¨ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆãã®1 è‘—è€…æƒ…å ±ã®è¡¨ç¤ºï¼‰
date: 2021-09-01
author: kenzauros
tags: [Node.js, Web, Gatsby.js]
---

**Gatsbyjs ã§è¨˜äº‹ã”ã¨ã®è‘—è€…ã®ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã—ãŸã„**ã¨æ€ã£ãŸã¨ã“ã‚ã€ç°¡å˜ãªã“ã¨ã®ã‚ˆã†ã§ã™ãŒã€æ„å¤–ã¨æ‰‹ã“ãšã‚Šã¾ã—ãŸã€‚

æœ€é©ãªã‚„ã‚Šæ–¹ã§ã¯ãªã„ã¨ã¯æ€ã„ã¾ã™ãŒã€ 1 ã¤ã®ã‚„ã‚Šæ–¹ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚

ãªãŠã€è¨˜äº‹ãŒé•·ããªã£ã¦ã—ã¾ã£ãŸã®ã§ã€äºŒæœ¬ç«‹ã¦ã§ãŠé€ã‚Šã„ãŸã—ã¾ã™ã€‚

1. å„è¨˜äº‹ã«è‘—è€…æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ ğŸ‘ˆã„ã¾ã“ã“
2. [è‘—è€…æƒ…å ±ã«ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹](https://mseeeen.msen.jp/gatsbyjs-author-bio-and-avatar-for-each-post-2)

## æ¦‚è¦

Gatsby ã® [gatsby-starter-blog](https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog) ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã§ã¯è‘—è€…ãŒ Kyle Mathews å›ºå®šã«ãªã£ã¦ã„ã¾ã™ã€‚

![](images/gatsbyjs-author-bio-and-avatar-for-each-post-1-1.png)

ã“ã‚Œã‚’è¨˜äº‹ã”ã¨ã®è‘—è€… (author) ã«åˆã‚ã›ãŸè‘—è€…æƒ…å ±ã¨ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

![](images/gatsbyjs-author-bio-and-avatar-for-each-post-1-2.png)

## å‰ææ¡ä»¶

### ç’°å¢ƒ

- Node.js 14
- Gatsby 3.11.1

### ä»•æ§˜

- ãƒ™ãƒ¼ã‚¹ã¯ [gatsby-starter-blog](https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog) ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨
- å„è¨˜äº‹ãƒšãƒ¼ã‚¸ã«è‘—è€…æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹
- è‘—è€…ã¯å…¨å“¡ GitHub ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹
- å„è¨˜äº‹ã®è‘—è€…ã¯ frontmatter ã® `author` ã§ GitHub ã® ID ã‚’æŒ‡å®šã™ã‚‹
- ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã¯ GitHub ã®ã‚¢ãƒã‚¿ãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹

ä»Šå›ã®æƒ³å®šã¯å–ã‚Šæ‰±ã†è‘—è€…ãŒå…¨å“¡ IT æŠ€è¡“è€…ã®ãŸã‚ã€ä¸Šè¨˜ã®ã‚ˆã†ãªä»•æ§˜ã«ã—ã¦ã„ã¾ã™ã€‚

GitHub ã®ã‚¢ãƒã‚¿ãƒ¼ã§ãªã„å ´åˆã¯ã€é©å®œèª­ã¿æ›¿ãˆã€å¿œç”¨ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚


## è‘—è€…æƒ…å ±ã‚’ YAML ã‹ã‚‰èª­ã¿è¾¼ã‚€

ã¾ãšã€**è‘—è€…æƒ…å ±ã‚’ YAML ã‹ã‚‰èª­ã¿è¾¼ã‚“ã§å„ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹**éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã€ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã® Node mapping ã®é …ã«ä¾‹ã¨ã—ã¦æŒ™ãŒã£ã¦ã„ã‚‹ã®ã§ã€ãã®ã¾ã¾åˆ©ç”¨ã§ãã¾ã™ã€‚

- [Mapping node types - Gatsby Config API | Gatsby](https://www.gatsbyjs.com/docs/reference/config-files/gatsby-config/#mapping-node-types)

### è¨˜äº‹ã«è‘—è€…æƒ…å ±ã‚’ã¤ã‘ã‚‹

ä»Šå›ã¯**è‘—è€…æƒ…å ±ã¯ GitHub ã® ID ã§æŒ‡å®š**ã—ã¾ã™ã®ã§ã€ **frontmatter** ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```md
---
title: My First Post
author: kenzauros
---

POST BODY here
```

### è‘—è€…æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

**è‘—è€…æƒ…å ±ã‚’åˆ—æŒ™ã—ãŸ YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ**ã—ã¾ã™ã€‚ã¨ã‚Šã‚ãˆãš 3 åã»ã©æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚

ä»Šå›ã¯ `src/data/author.yaml` ã¨ã—ã¦é…ç½®ã—ã¾ã™ã€‚

```yaml
- id: kenzauros
  name: Kenji Yamada
  bio: æ—…è¡Œã«ã„ããŸã„
- id: norikazum
  name: Norikazu Masuda
  bio: ç”·å‰ã§ã‚“ãŒãª
- id: kyoshin
  name: Kiyoshi Koyama
  bio: ãƒ‘ãƒãƒ—ãƒ­
```

`bio` ã¯ã‚µãƒ³ãƒ—ãƒ«é€šã‚Šè‡ªå·±ç´¹ä»‹ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚ä»–ã«å¿…è¦ãªå±æ€§ãŒã‚ã‚‹å ´åˆã¯è¿½è¨˜ã—ã¾ã—ã‚‡ã†ã€‚

### transformer ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

è‘—è€…æƒ…å ±ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€ã®ã§ã€å¯¾å¿œã—ãŸ transformer ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ **YAML ã®å ´åˆã¯ [gatsby-transformer-yaml](https://www.gatsbyjs.com/plugins/gatsby-transformer-yaml/)** ã«ãªã‚Šã¾ã™ã€‚

```
npm install gatsby-transformer-yaml
```

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª¬æ˜ã«ã‚ã‚‹ã‚ˆã†ã« **`gatsby-config.js`** ã«è¨­å®šã—ã¾ã™ã€‚

`plugins` ã« `gatsby-transformer-yaml` ã‚’åŠ ãˆã€ã•ã‚‰ã« `gatsby-source-filesystem` ã§ YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

ã¾ãŸã€ `mapping` ã« `MarkdownRemark.frontmatter.author` ãŒ `AuthorYaml` (`author.yaml`) ã§è§£æ±ºã•ã‚Œã‚‹ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

```js
module.exports = {
  plugins: [
    `gatsby-transformer-yaml`,
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        path: `./src/data/`,
      },
    },
    // ... other plugins
  ],
  mapping: {
    "MarkdownRemark.frontmatter.author": `AuthorYaml`,
  },
}
```

ä»¥ä¸Šã§è‘—è€…æƒ…å ±ã®è¨­å®šã¯å®Œäº†ã§ã™ã€‚

ã“ã‚Œã§ãŸã¨ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚¯ã‚¨ãƒªã§ãã¾ã™ã€‚

```graphql
query ($id: String!) {
  markdownRemark(id: { eq: $id }) {
    id
    html
    frontmatter {
      title
      description
      author {
        # author.yaml ã®æƒ…å ±ãŒå±•é–‹ã•ã‚Œã‚‹
        id
        name
        bio
      }
    }
  }
}
```

### è¨˜äº‹å´ã‹ã‚‰ Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«è‘—è€…æƒ…å ±ã‚’æ¸¡ã™

æ¬¡ã«ãƒ•ãƒƒã‚¿ãƒ¼ã«ã•ãã»ã©ã®è‘—è€…æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãš **`src/templates/blog-post.js` ã® `pageQuery` ã‚’ç·¨é›†ã—ã¦ `author` ã®æƒ…å ±ã‚’å–å¾—**ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```js
export const pageQuery = graphql`
  query BlogPostBySlug(
    $id: String!
    $previousPostId: String
    $nextPostId: String
  ) {
    markdownRemark(id: { eq: $id }) {
      id
      excerpt(pruneLength: 160)
      html
      frontmatter {
        title
        date(formatString: "MMMM DD, YYYY")
        description
        author {
          id
          name
          bio
        }
      }
// ä»¥ä¸‹ç•¥
```

ã“ã®å–å¾—ã—ãŸæƒ…å ±ã‚’ Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```jsx
  const author = post.frontmatter.author;

  return (
        {/* ç•¥ */}
        <footer>
          { author
            ? <Bio
                github={author.id}
                name={author.name}
                bio={author.bio}
                />
            : null }
        </footer>
        {/* ç•¥ */}
  )
```

### bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿®æ­£

ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ `siteMetadata` ã‹ã‚‰é™çš„ã«å–å¾—ã—ãŸ Kyle Mathews ã®æƒ…å ±ãŒå›ºå®šçš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã•ãã»ã©è¨˜äº‹ãƒšãƒ¼ã‚¸å´ã‹ã‚‰æ¸¡ã—ãŸ `author` ã®å€¤ã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã† `src/components/bio.js` ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãš `StaticImage` ã®ã‚ãŸã‚Šã‚’ã°ã£ã•ã‚Šå‰Šã£ã¦ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¾ã—ãŸã€‚

```jsx
import * as React from "react"

const Bio = (props) => {
  const bio = props.bio || null;
  const github = props.github;
  const name = props.name || 'åç„¡ã—ã®æ¨©å…µè¡›';
  const githubUrl = github ? `https://github.com/${github}` : null;

  return (
    <div className="bio">
      <div>
        <p>
          <strong>{name}</strong>
          { github ? <> (<a href="{githubUrl}" target="_blank" rel="noopener">{github}</a>)</> : null }
        </p>
        <p>{bio}</p>
      </div>
    </div>
  )
}

export default Bio
```

ã“ã‚Œã§ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¯ãšã§ã™ã€‚

![](images/gatsbyjs-author-bio-and-avatar-for-each-post-1-3.png)

ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãŒãªã„ã®ã§å°‘ã—å¯‚ã—ã„æ„Ÿã˜ã§ã™ãŒã€ç„¡äº‹è¨˜äº‹ã”ã¨è‘—è€…ãŒè¡¨ç¤ºã§ãã¾ã—ãŸğŸ™Œ

[å¾ŒåŠ](https://mseeeen.msen.jp/gatsbyjs-author-bio-and-avatar-for-each-post-2)ã¸ç¶šãã¾ã™ğŸ‘‰