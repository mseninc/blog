---
title: Gatsby ã§è¨˜äº‹ã”ã¨ã®è‘—è€…æƒ…å ±ã¨ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆãã®2 ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã®è¡¨ç¤ºï¼‰
date: 2021-09-01
author: kenzauros
tags: [Node.js, Web, Gatsby.js]
---

**Gatsbyjs ã§è¨˜äº‹ã”ã¨ã®è‘—è€…ã®ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹**æ–¹æ³•ã«ã¤ã„ã¦ã€äºŒæœ¬ç«‹ã¦ã§ãŠé€ã‚Šã—ã¦ãŠã‚Šã¾ã™ã€‚

1. [å„è¨˜äº‹ã«è‘—è€…æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹](https://mseeeen.msen.jp/gatsbyjs-author-bio-and-avatar-for-each-post-1)
2. è‘—è€…æƒ…å ±ã«ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ ğŸ‘ˆã„ã¾ã“ã“

## æ¦‚è¦

[å‰å›](https://mseeeen.msen.jp/gatsbyjs-author-bio-and-avatar-for-each-post-1)ã®ãŠã•ã‚‰ã„ã§ã™ã€‚

Gatsby ã® [gatsby-starter-blog](https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog) ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã§ã¯è‘—è€…ãŒ Kyle Mathews å›ºå®šã«ãªã£ã¦ã„ã¾ã™ã€‚

<a href="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-1.png"><img src="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-1.png" alt="" width="650" height="258" class="aligncenter size-full wp-image-18146" /></a>

ã“ã‚Œã‚’è¨˜äº‹ã”ã¨ã®è‘—è€… (author) ã«åˆã‚ã›ãŸè‘—è€…æƒ…å ±ã¨ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

<a href="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-2.png"><img src="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-2.png" alt="" width="646" height="106" class="aligncenter size-full wp-image-18157" /></a>

å‰å›ã¯ã“ã‚“ãªæ„Ÿã˜ã§è‘—è€…æƒ…å ±ã‚’ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãªã—ã§è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§ã‚’ã‚„ã‚Šã¾ã—ãŸğŸ‘‡

<a href="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-3.png"><img src="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-3.png" alt="" width="649" height="111" class="aligncenter size-full wp-image-18150" /></a>

## å‰ææ¡ä»¶

ã“ã¡ã‚‰ã‚‚å†æ²ã§ã™ã€‚

### ç’°å¢ƒ

- Node.js 14
- Gatsby 3.11.1

### ä»•æ§˜

- ãƒ™ãƒ¼ã‚¹ã¯ [gatsby-starter-blog](https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog) ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨
- å„è¨˜äº‹ãƒšãƒ¼ã‚¸ã«è‘—è€…æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹
- è‘—è€…ã¯å…¨å“¡ GitHub ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹
- å„è¨˜äº‹ã®è‘—è€…ã¯ frontmatter ã® `author` ã§ GitHub ã® ID ã‚’æŒ‡å®šã™ã‚‹
- ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã¯ GitHub ã®ã‚¢ãƒã‚¿ãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹

ä»Šå›ã®æƒ³å®šã¯å–ã‚Šæ‰±ã†è‘—è€…ãŒå…¨å“¡ IT æŠ€è¡“è€…ã®ãŸã‚ã€ä¸Šè¨˜ã®ã‚ˆã†ãªä»•æ§˜ã«ã—ã¦ã„ã¾ã™ã€‚

GitHub ã®ã‚¢ãƒã‚¿ãƒ¼ã§ãªã„å ´åˆã¯ã€é©å®œèª­ã¿æ›¿ãˆã€å¿œç”¨ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚


## ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’èª­ã¿è¾¼ã‚€

ã•ã¦ã„ã‚ˆã„ã‚ˆæœ¬é¡Œã§ã™ã€‚**ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’ GitHub ã‹ã‚‰èª­ã¿è¾¼ã‚“ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã€ã•ãã»ã©ã® Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«è¡¨ç¤º**ã—ã¦ã„ãã¾ã™ã€‚

åŸºæœ¬çš„ã«ã¯ [Gatsby Node - Preprocessing External Images | Gatsby](https://www.gatsbyjs.com/docs/how-to/images-and-media/preprocessing-external-images/#gatsby-node) ã®æ–¹æ³•ã‚’å‚è€ƒã«ã—ã¾ã™ã€‚


### ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

ã¾ãš **`gatsby-node.js` ã‚’ç·¨é›†ã—ã¦ frontmatter ã«ç”»åƒ"ãƒ•ã‚¡ã‚¤ãƒ«"ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ **ã—ã¾ã™ã€‚ã“ã“ã§ã¯åå‰ã¯ `avatarImage` ã¨ã—ã¾ã™ã€‚

```js
exports.createSchemaCustomization = ({ actions }) => {
  const { createTypes } = actions

  createTypes(`
    type MarkdownRemark implements Node {
      frontmatter: Frontmatter
      fields: Fields
    }

    type Frontmatter {
      title: String
      description: String
      date: Date @dateformat
      avatarImage: File @link(from: "avatarImage__NODE")
    }

    type Fields {
      slug: String
    }
  `)
}
```

**`avatarImage: File @link(from: "avatarImage__NODE")`** ãŒè¿½åŠ éƒ¨åˆ†ã§ã™ã€‚

ã“ã® `avatarImage__NODE` ãŒãƒªãƒ³ã‚¯å…ƒã¨ãªã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãªã‚Šã¾ã™ã€‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¯ä»»æ„ã§ã™ãŒã€ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã‹ã¶ã‚‹å¯èƒ½æ€§ã®ãªã„ã‚‚ã®ã«ã—ã¾ã™ã€‚

ãªãŠ `Frontmatter.author` ã¯ `mapping` ã§ãƒªãƒ³ã‚¯ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã® GraphQL ã® Type å®£è¨€ã«ã¯ç™»å ´ã—ã¦ã„ãªã„ã“ã¨ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚

æ¬¡ã«åŒã˜ã **`gatsby-node.js` ã® `onCreateNode` ã§ `avatarImage__NODE` ã®ä¸­èº«ã‚’è¨­å®š**ã—ã¾ã™ã€‚

```js
// å†’é ­ã§ createRemoteFileNode ã® require ãŒå¿…è¦ã§ã™
const { createRemoteFileNode } = require(`gatsby-source-filesystem`) 

exports.onCreateNode = async ({
  node,
  actions,
  getNode,
  store,
  cache,
  createNodeId,
}) => {
  const { createNode, createNodeField } = actions

  if (node.internal.type === `MarkdownRemark`) {
    const value = createFilePath({ node, getNode })

    createNodeField({
      name: `slug`,
      node,
      value,
    })

    if (node.frontmatter.author) {
      const url = `https://avatars.githubusercontent.com/${node.frontmatter.author}`;
      const fileNode = await createRemoteFileNode({
        url, // string that points to the URL of the image
        parentNodeId: node.id, // id of the parent node of the fileNode you are going to create
        createNode, // helper function in gatsby-node to generate the node
        createNodeId, // helper function in gatsby-node to generate the node id
        cache, // Gatsby's cache
        store, // Gatsby's Redux store
      })
      if (fileNode) {
        node.frontmatter.avatarImage__NODE = fileNode.id
      }
    }
  }
}
```

`slug` ã®éƒ¨åˆ†ã¯ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚‚ã¨ã‚‚ã¨è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ã®ã‚¹ãƒ©ã‚°ã‚’æŒ‡å®šã™ã‚‹éƒ¨åˆ†ã§ã™ã­ã€‚

ãã‚Œä»¥å¤–ãªã‹ãªã‹ã‚„ã‚„ã“ã—ã„ã§ã™ãŒã€åŸºæœ¬çš„ã«ã¯ **`createRemoteFileNode` ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ¼ãƒ‰ã‚’ä½œæˆã—ã€å…ˆã»ã©ã® `avatarImage__NODE ` ã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»£å…¥**ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

`createRemoteFileNode` ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒä¸¦ã³ã¾ã™ãŒã€ã»ã¨ã‚“ã©ã¯ `onCreateNode` ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ãã®ã¾ã¾æ¸¡ã›ã°å¤§ä¸ˆå¤«ã§ã™ã€‚

ã“ã“ã§ `url` ã¯ https://avatars.githubusercontent.com/ ã« `node.frontmatter.author` ã‚’ãã£ã¤ã‘ã¦ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
ãŸã¨ãˆã°ç§ã® GitHub ID `kenzauros` ãªã‚‰ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

[https://avatars.githubusercontent.com/kenzauros](https://avatars.githubusercontent.com/kenzauros)

ã“ã®æ™‚ç‚¹ã§ã¯ **`node.frontmatter.author` ã¯ author.yaml ã®æƒ…å ±ã«è§£æ±ºã•ã‚Œã¦ã„ãªã„**ã“ã¨ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
ã‚ˆã£ã¦ã“ã® **`node.frontmatter.author` ã«ã¯è¨˜äº‹ã® frontmatter ã§æŒ‡å®šã—ãŸ `author` ãŒãã®ã¾ã¾å…¥ã£ã¦ã„ã¾ã™**ã€‚

GraphQL ã®å®£è¨€ã§ `avatarImage` ã‚’ `node.frontmatter.author` ã®ä¸‹å±¤ã§ãªã `node.frontmatter` ã®ä¸‹å±¤ã«å®šç¾©ã—ã¦ã„ã‚‹ã®ã‚‚ã“ã‚ŒãŒç†ç”±ã§ã™ã€‚


### GraphQL ã‚¯ã‚¨ãƒªãƒ¼ã§ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’å–å¾—

ã„ã‚ˆã„ã‚ˆã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’å¾©æ´»ã•ã›ã¾ã—ã‚‡ã†ã€‚

ã¾ãš **`src/templates/blog-post.js` ã® `pageQuery` ã« `avatarImage` ã‚’è¿½åŠ **ã—ã¾ã™ã€‚

```GraphQL
    markdownRemark(id: { eq: $id }) {
      id
      excerpt(pruneLength: 160)
      html
      frontmatter {
        title
        date(formatString: "MMMM DD, YYYY")
        description
        author {
          id
          name
          bio
        }
        avatarImage {
          childImageSharp {
            gatsbyImageData(width: 50, height: 50, layout: FIXED)
          }
        }
      }
    }
```

ã“ã“ã§ **`avatarImage` ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã§ã™ã€‚ã“ã‚Œã« `childImageSharp`, `gatsbyImageData` ã‚’æŒ‡å®šã—ã¦æœ€é©åŒ–ã•ã‚ŒãŸç”»åƒã«å¤‰æ›ã—ã¾ã™ã€‚

æ¬¡ã«ã“ã®ã‚¯ã‚¨ãƒªãƒ¼ã§å–å¾—ã—ãŸç”»åƒã‚’ Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã¾ã™ã€‚

```jsx
<footer>
  { author
    ? <Bio
        github={author.id}
        name={author.name}
        bio={author.bio}
        avatarImage={post.frontmatter.avatarImage}
        />
    : null }
</footer>
```

### Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿®æ­£

æ¬¡ã« Bio ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ `props` ã‹ã‚‰æ¸¡ã•ã‚ŒãŸç”»åƒã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

å…ƒã€…ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã ã£ãŸãŸã‚ `StaticImage` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½¿ã‚ã‚Œã¦ã„ã¾ã—ãŸãŒã€**å‹•çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã•ã›ã‚‹ãŸã‚ `GatsbyImage` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã‚’ä½¿ã„ã¾ã™ã€‚

```jsx
import * as React from "react"
import { GatsbyImage, getImage } from "gatsby-plugin-image"

const Bio = (props) => {
  const bio = props.bio || null;
  const github = props.github;
  const name = props.name || 'åç„¡ã—ã®æ¨©å…µè¡›';
  const githubUrl = github ? `https://github.com/${github}` : null;
  const avatarImage = getImage(props.avatarImage)

  return (
    <div className="bio">
      <GatsbyImage
        image={avatarImage}
        className="bio-avatar"
        width={50}
        height={50}
        alt={github}
        />
      <div>
        <p>
          <strong>{name}</strong>
          { github ? <> (<a href="{githubUrl}" target="_blank" rel="noopener">{github}</a>)</> : null }
        </p>
        <p>{bio}</p>
      </div>
    </div>
  )
}

export default Bio
```

GatsbyImage ã® `image` ã«ã¯ `IGatsbyImageData` å‹ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã®ã§ã€ `avatarImage` ã‹ã‚‰ **`getImage()` ã§ `file.childImageSharp.gatsbyImageData` ã‚’å–å¾—**ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ãŸã‚Šã¯ [gatsby-plugin-image](https://www.gatsbyjs.com/plugins/gatsby-plugin-image/) ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã•ã¦ã€ã“ã‚Œã§ä¸‹è¨˜ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚Œã° OK ã§ã™ğŸ˜ƒ

<a href="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-2.png"><img src="images/gatsbyjs-author-bio-and-avatar-for-each-post-2-2.png" alt="" width="646" height="106" class="aligncenter size-full wp-image-18157" /></a>

ãŠç–²ã‚Œæ§˜ã§ã—ãŸğŸ˜…
